#!/usr/bin/env bash

set -euo pipefail

APP_NAME="riff"
INSTALL_PATH="/usr/local/bin"
VENV_DIR="venv"

echo "[*] Creating virtual environment"
python3 -m venv "$VENV_DIR"

echo "[*] Activating virtual environment"
source "$VENV_DIR/bin/activate"

echo "[*] Upgrading pip"
pip install --upgrade pip

echo "[*] Installing dependencies"
pip install -r requirements.txt
pip install pyinstaller

echo "[*] Building executable"

pyinstaller \
  --clean \
  --onefile \
  --name "$APP_NAME" \
  --paths src \
  --collect-all rich \
  src/main.py

echo "[*] Installing binary to $INSTALL_PATH"
sudo install -m 0755 "dist/$APP_NAME" "$INSTALL_PATH/$APP_NAME"

echo "[*] Cleaning up build artifacts"
rm -rf build dist "$APP_NAME.spec"

echo "[âœ“] Installation complete. Run with: $APP_NAME"
